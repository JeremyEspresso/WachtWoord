@page "/add"
@using WachtWoord.BLL
@using WachtWoord.Models.Services
@inject NavigationManager NavigationManager


<div class="font-sans w-full">
    <div class="grid h-screen place-items-center">
        <div class="items-center w-1/3">
            
            <EditForm EditContext="@editContext" class="bg-zinc-100 shadow-md rounded-md px-8 pt-6 pb-8 mb-4" OnSubmit="@HandleSubmit">
                <div class="mb-4">
                    <h1 class="text-xl font-bold text-zinc-800 mb-2">New Password</h1>
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="title">
                        Title
                    </label>
                    <input required @bind-value="entry.Title" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="title" type="text">

                    <label class="block text-gray-700 text-sm font-bold mb-2" for="username">
                        Username
                    </label>
                    <input @bind-value="entry.Username" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="username" type="text">

                    <label class="block text-gray-700 text-sm font-bold mb-2" for="Url">
                        URL
                    </label>
                    <input @bind-value="entry.URL" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="url" type="text">

                    <label class="block text-gray-700 text-sm font-bold mb-2" for="Url">
                        Password Length
                    </label>
                    <input @bind-value="entry.Length" min="16" max="128" class="mb-0 shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="length" type="number">
                    <span class="text-xs italic text-gray-500">Range between 16 and 128</span>
                </div>
                <div class="flex items-center justify-between">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-500 text-white focus:outline-zinc-800 font-bold py-2 px-4 rounded focus:shadow-outline">
                        Generate Password
                    </button>
                </div>
            </EditForm>
        </div>
    </div>
</div>

@code {
    private Entry entry = new Entry(){Length = 32};
    private EntryService _EntryService = new();
    private EditContext? editContext;

    protected override void OnInitialized()
    {
        editContext = new(entry);
    }

    private void HandleSubmit()
    {
        if (editContext != null && editContext.Validate())
        {
            PasswordGenerator PwGenerator = new PasswordGenerator(entry.Length);
            entry.Password = PwGenerator.GeneratePassword();
            _EntryService.AddEntry(entry);
            NavigationManager.NavigateTo("/dashboard");
        }
    }
    
    /*
    void SubmitOnClick()
    {
        
        string password = passGen.GeneratePassword();
        int strength = PasswordStrength.GetPasswordStrength(password);

        _EntryService.AddEntry(new Entry
            {
                Title = Title,
                Username = Username,
                URL = Url,
                Password = password,
                Strength = strength,
                CreationDate = DateTime.Now
            });
        NavigationManager.NavigateTo("/dashboard");
        */
    }
}


