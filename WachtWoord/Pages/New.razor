@page "/add"
@using WachtWoord.BLL
@using WachtWoord.Models.Services
@inject NavigationManager NavigationManager

<div class="font-sans w-full">
    <div class="grid h-screen place-items-center">
        <div class="items-center w-1/3">

            <form class="bg-zinc-100 shadow-md rounded-md px-8 pt-6 pb-8 mb-4">
                <div class="mb-4">
                    <h1 class="text-xl font-bold text-zinc-800 mb-2">New Password</h1>

                    <label class="block text-gray-700 text-sm font-bold mb-2" for="title">
                        Title
                    </label>
                    <input @bind=@Title @oninput="@((e) => {Title=(string)e.Value;})" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="title" type="text">

                    <label class="block text-gray-700 text-sm font-bold mb-2" for="username">
                        Username
                    </label>
                    <input @bind=@Username @oninput="@((e) => {Username=(string)e.Value;})" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="username" type="text">

                    <label class="block text-gray-700 text-sm font-bold mb-2" for="Url">
                        URL
                    </label>
                    <input @bind=@Url @oninput="@((e) => {Url=(string)e.Value;})" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="url" type="text">

                    <label class="block text-gray-700 text-sm font-bold mb-2" for="Url">
                        Password Length
                    </label>
                    <input onkeydown="return false" @bind=@passwordLength @oninput="@((e) => {passwordLength=Int32.Parse((string)e.Value) > 128 ? 128 : Int32.Parse((string)e.Value);})" min="16" max="128" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="length" type="number">
                </div>
                <div class="flex items-center justify-between">
                    <button @onclick="SubmitOnClick" class="bg-blue-600 hover:bg-blue-500 text-white focus:outline-zinc-800 font-bold py-2 px-4 rounded focus:shadow-outline" type="button">
                        Generate Password
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@code {
    private string Title { get; set; }
    private string Username { get; set; }
    private string Url { get; set; }
    private int passwordLength { get; set; } = 64;

    private EntryService _EntryService = new();

    void SubmitOnClick()
    {
        PasswordGenerator passGen = new PasswordGenerator(passwordLength);
        string password = passGen.GeneratePassword();
        int strength = PasswordStrength.GetPasswordStrength(password);

        _EntryService.AddEntry(new Entry
            {
                Title = Title,
                Username = Username,
                URL = Url,
                Password = password,
                Strength = strength,
                CreationDate = DateTime.Now
            });
        NavigationManager.NavigateTo("/dashboard");
    }
}


